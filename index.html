<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì—°ì²œêµ° ìì—°ê´€ê´‘ì§€ â€” API ê¸°ë°˜ ì˜ˆì‹œ</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  :root{
    --primary:#0B63B8; --secondary:#2E8B57; --accent:#F9C300;
    --bg:#FAFBFC; --card-bg:#fff; --muted:#F1F6F9; --text:#2B2B2B;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;padding-bottom:40px;}
  header{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:40px 14px;text-align:center}
  header h1{font-size:1.6rem;margin-bottom:6px} header p{opacity:.95}
  .container{max-width:1200px;margin:18px auto;padding:0 14px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;align-items:center}
  .btn{padding:9px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;background:var(--primary);color:#fff}
  .btn.ghost{background:var(--card-bg);color:var(--text);border:1px solid rgba(0,0,0,0.06)}
  .layout{display:grid;grid-template-columns:1fr 420px;gap:14px}
  #map{height:640px;border-radius:12px;box-shadow:0 6px 18px rgba(11,99,184,0.06);border:1px solid rgba(0,0,0,0.04)}
  .panel{background:var(--card-bg);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(11,99,184,0.06);height:640px;overflow:auto}
  .search-row{display:flex;gap:8px;margin-bottom:8px}
  input[type="text"]{padding:8px;border-radius:8px;border:1px solid #e6eef9;flex:1}
  .list-grid{display:grid;gap:10px}
  .card{display:flex;gap:10px;padding:10px;border-radius:10px;align-items:flex-start;cursor:pointer;border:1px solid rgba(0,0,0,0.04);transition:transform .12s}
  .card:hover{transform:translateY(-6px)}
  .card img{width:98px;height:64px;object-fit:cover;border-radius:8px;flex-shrink:0}
  .meta strong{color:var(--primary);display:block}
  .meta small{color:#6b747a;display:block;margin-top:6px}
  .detail img{width:100%;border-radius:10px;max-height:260px;object-fit:cover;margin-bottom:8px}
  .route-list{margin-top:10px}
  .route-list li{padding:8px 10px;border-radius:8px;background:var(--muted);margin-bottom:6px;list-style:none}
  footer{max-width:1200px;margin:18px auto;text-align:center;color:#6b747a;padding:12px}
  @media(max-width:980px){ .layout{grid-template-columns:1fr} .panel{height:auto} #map{height:420px} }
</style>
</head>
<body>
<header>
  <h1>ğŸŒ¿ ì—°ì²œêµ° ìì—°ê´€ê´‘ì§€ (TourAPI ì˜ˆì‹œ)</h1>
  <p>API ì‘ë‹µ(XML) â†’ íŒŒì‹± â†’ ì§€ë„Â·ëª©ë¡Â·ì¶”ì²œê²½ë¡œ í‘œì‹œ ì˜ˆì œ</p>
</header>

<div class="container">
  <div class="controls">
    <!-- IMPORTANT: Replace SERVICE_URL value in script below with your actual API request URL (include ServiceKey) if you want live fetch -->
    <button class="btn" id="btn-load-api">APIì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸° (ì‹¤ì œ í‚¤ í•„ìš”)</button>
    <button class="btn ghost" id="btn-use-sample">ë‚´ì¥ XML ìƒ˜í”Œë¡œ ì‚¬ìš©</button>
    <button class="btn ghost" id="btn-recommend">ì¶”ì²œ ë£¨íŠ¸ ìƒì„±</button>
    <button class="btn ghost" id="btn-clear-route">ë£¨íŠ¸ ì§€ìš°ê¸°</button>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <label style="font-size:13px;color:#555">ì¶œë°œì§€:</label>
      <select id="start-select" style="padding:8px;border-radius:8px;border:1px solid #eee"></select>
    </div>
  </div>

  <div class="layout">
    <div id="map"></div>

    <aside class="panel">
      <div class="search-row">
        <input id="search-input" placeholder="ì¥ì†Œëª… ê²€ìƒ‰(ì˜ˆ: ì¬ì¸í­í¬)"/>
        <button class="btn ghost" id="btn-search">ê²€ìƒ‰</button>
      </div>

      <h3 style="margin-bottom:8px">ê´€ê´‘ì§€ ëª©ë¡</h3>
      <div id="list" class="list-grid"></div>

      <div id="detail" class="detail" style="margin-top:12px;display:none"></div>

      <div id="route-result" style="margin-top:12px;display:none">
        <h4>ì¶”ì²œ ë£¨íŠ¸</h4>
        <ol id="route-list" class="route-list"></ol>
        <div style="margin-top:8px;font-size:14px;color:#444">ì´ ì´ë™(ì§ì„ ê±°ë¦¬ í•©): <strong id="total-distance">0 km</strong></div>
      </div>
    </aside>
  </div>
</div>

<footer>
  ì´ í˜ì´ì§€ëŠ” TourAPI ì‘ë‹µ(XML ìƒ˜í”Œ)ì„ ì‚¬ìš©í•œ ë°ëª¨ì…ë‹ˆë‹¤. API í‚¤ëŠ” ì ˆëŒ€ ê³µê°œí•˜ì§€ ë§ˆì„¸ìš”.
</footer>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/*
  ì‚¬ìš©ë°©ë²•:
  - ì‹¤ì œ TourAPIì—ì„œ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ì•„ë˜ SERVICE_URLì— ìš”ì²­ URLì„ ë„£ìœ¼ì„¸ìš”(ì„œë¹„ìŠ¤í‚¤ í¬í•¨).
    ì˜ˆ:
    const SERVICE_URL = 'http://apis.data.go.kr/B551011/KorService2/areaBasedList2?numOfRows=12&pageNo=1&MobileOS=ETC&MobileApp=AppTest&ServiceKey=ì—¬ê¸°ì—_ì¸ì¦í‚¤&arrange=A&contentTypeId=12&areaCode=31&sigunguCode=21&cat1=A01';
  - ë¸Œë¼ìš°ì €ì—ì„œ CORS ì°¨ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ì„œë²„ë¦¬ìŠ¤ í”„ë¡ì‹œ(Cloudflare Worker ë“±)ì— SERVICE_URLì„ ë„£ê³  í”„ë¡ì‹œë¥¼ í˜¸ì¶œí•˜ì„¸ìš”.
  - í‚¤ê°€ ì—†ê±°ë‚˜ CORS ë¬¸ì œ ì‹œ "ë‚´ì¥ XML ìƒ˜í”Œë¡œ ì‚¬ìš©" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë°”ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
*/

const SERVICE_URL = ''; // <-- ì‹¤ì‚¬ìš© ì‹œ ì—¬ê¸°ì— ì „ì²´ ìš”ì²­ URL(ì„œë¹„ìŠ¤í‚¤ í¬í•¨) ë„£ìœ¼ì„¸ìš”.

const xmlSample = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?><response><header>
  <resultCode>0000</resultCode>
  <resultMsg>OK</resultMsg>
</header><body><items>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì‹ ì„œë©´ ëŒ€ê´‘ë¦¬</addr1>
    <addr2></addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010400</cat3>
    <contentid>127163</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20030327090000</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/95/3537495_image2_1.jpg</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/95/3537495_image3_1.jpg</firstimage2>
    <cpyrhtDivCd>Type3</cpyrhtDivCd>
    <mapx>127.1674160678</mapx>
    <mapy>38.1977562930</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250915191415</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ê³ ëŒ€ì‚°</title>
    <zipcode>11000</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA01</lclsSystm2>
    <lclsSystm3>NA010100</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì‹ ì„œë©´ ê³ ëŒ€ì‚°ê¸¸ 84-79</addr1>
    <addr2></addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010600</cat3>
    <contentid>3018261</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20231005172754</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/03/3002903_image2_1.jpg</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/03/3002903_image3_1.jpg</firstimage2>
    <cpyrhtDivCd>Type3</cpyrhtDivCd>
    <mapx>127.1506644287</mapx>
    <mapy>38.2113155104</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250701170813</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ê³ ëŒ€ì‚°ìì—°íœ´ì–‘ë¦¼</title>
    <zipcode>11001</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA04</lclsSystm2>
    <lclsSystm3>NA040600</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì—°ì²œì ë™ë§‰ë¦¬</addr1>
    <addr2>198</addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010500</cat3>
    <contentid>2616251</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20190822014513</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/54/3518754_image2_1.jpg</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/54/3518754_image3_1.jpg</firstimage2>
    <cpyrhtDivCd>Type1</cpyrhtDivCd>
    <mapx>127.1114269423</mapx>
    <mapy>38.0969003950</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250808135854</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ë™ë§‰ê³¨ ì‘íšŒì•” (í•œíƒ„ê°• ìœ ë„¤ìŠ¤ì½” ì„¸ê³„ì§€ì§ˆê³µì›)</title>
    <zipcode>11011</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA04</lclsSystm2>
    <lclsSystm3>NA040400</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì—°ì²œì ê³ ë¬¸ë¦¬</addr1>
    <addr2>212</addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010500</cat3>
    <contentid>2616492</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20190826231730</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/39/3537539_image2_1.jpg</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/39/3537539_image3_1.jpg</firstimage2>
    <cpyrhtDivCd>Type3</cpyrhtDivCd>
    <mapx>127.1174163087</mapx>
    <mapy>38.0617546108</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250915193512</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ë°±ì˜ë¦¬ì¸µ (í•œíƒ„ê°• ìœ ë„¤ìŠ¤ì½” ì„¸ê³„ì§€ì§ˆê³µì›)</title>
    <zipcode>11018</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA03</lclsSystm2>
    <lclsSystm3>NA030500</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì‹ ì„œë©´ í‰í™”ë¡œ 3282-76</addr1>
    <addr2></addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010500</cat3>
    <contentid>2735336</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20210819234618</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/81/3382281_image2_1.JPG</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/81/3382281_image3_1.JPG</firstimage2>
    <cpyrhtDivCd>Type3</cpyrhtDivCd>
    <mapx>127.1612210451</mapx>
    <mapy>38.2366849576</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250319175910</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ì—­ê³ ë“œë¦„</title>
    <zipcode>11001</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA04</lclsSystm2>
    <lclsSystm3>NA040500</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì²­ì‚°ë©´ ì´ˆì„±ë¦¬</addr1>
    <addr2></addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010900</cat3>
    <contentid>128044</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20040225090000</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/47/3537547_image2_1.jpg</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/47/3537547_image3_1.jpg</firstimage2>
    <cpyrhtDivCd>Type3</cpyrhtDivCd>
    <mapx>127.0853157997</mapx>
    <mapy>37.9894541362</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250915194510</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ì—´ë‘ê°œìš¸</title>
    <zipcode>11023</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA01</lclsSystm2>
    <lclsSystm3>NA010400</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì „ê³¡ì ì€ëŒ€ë¦¬</addr1>
    <addr2></addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010500</cat3>
    <contentid>2616500</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20190826233449</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/97/2616497_image2_1.bmp</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/97/2616497_image2_1.bmp</firstimage2>
    <cpyrhtDivCd>Type3</cpyrhtDivCd>
    <mapx>127.0564445744</mapx>
    <mapy>38.0461581003</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250320134352</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ì€ëŒ€ë¦¬ íŒìƒì ˆë¦¬ì™€ ìŠµê³¡êµ¬ì¡° (í•œíƒ„ê°• ìœ ë„¤ìŠ¤ì½” ì„¸ê³„ì§€ì§ˆê³µì›)</title>
    <zipcode>11024</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA04</lclsSystm2>
    <lclsSystm3>NA040500</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì¤‘ë©´ ì‚¼ê³¶ë¦¬</addr1>
    <addr2>422</addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010700</cat3>
    <contentid>2841245</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20220823100353</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/95/3092295_image2_1.jpg</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/95/3092295_image3_1.jpg</firstimage2>
    <cpyrhtDivCd>Type1</cpyrhtDivCd>
    <mapx>127.0171734736</mapx>
    <mapy>38.1313446498</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250904155051</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ì„ì§„ê°• ëŒ‘ì‹¸ë¦¬ì •ì›</title>
    <zipcode>11004</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA04</lclsSystm2>
    <lclsSystm3>NA040700</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ë¯¸ì‚°ë©´ ë™ì´ë¦¬</addr1>
    <addr2></addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010500</cat3>
    <contentid>2569474</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20181124225643</createdtime>
    <firstimage></firstimage>
    <firstimage2></firstimage2>
    <cpyrhtDivCd></cpyrhtDivCd>
    <mapx>127.0154490945</mapx>
    <mapy>38.0199326406</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250318143252</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ì„ì§„ê°• ì£¼ìƒì ˆë¦¬ (í•œíƒ„ê°• ìœ ë„¤ìŠ¤ì½” ì„¸ê³„ì§€ì§ˆê³µì›)</title>
    <zipcode>11047</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA04</lclsSystm2>
    <lclsSystm3>NA040400</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì¤‘ë©´ íš¡ì‚°ë¦¬ 224</addr1>
    <addr2></addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010500</cat3>
    <contentid>2569460</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20181124033008</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/54/2563654_image2_1.jpg</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/54/2563654_image3_1.jpg</firstimage2>
    <cpyrhtDivCd>Type3</cpyrhtDivCd>
    <mapx>126.9873487890</mapx>
    <mapy>38.1191510887</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20241204160609</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ì„ì§„ê°•í‰í™”ìŠµì§€ì›</title>
    <zipcode>11004</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA03</lclsSystm2>
    <lclsSystm3>NA030400</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì—°ì²œì ë¶€ê³¡ë¦¬ 192</addr1>
    <addr2></addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010800</cat3>
    <contentid>125496</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20040225090000</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/05/3532805_image2_1.jpg</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/05/3532805_image3_1.jpg</firstimage2>
    <cpyrhtDivCd>Type1</cpyrhtDivCd>
    <mapx>127.1427246484</mapx>
    <mapy>38.0772227105</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250909173100</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ì¬ì¸í­í¬ (í•œíƒ„ê°• ìœ ë„¤ìŠ¤ì½” ì„¸ê³„ì§€ì§ˆê³µì›)</title>
    <zipcode>11018</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA01</lclsSystm2>
    <lclsSystm3>NA010300</lclsSystm3>
  </item>
  <item>
    <addr1>ê²½ê¸°ë„ ì—°ì²œêµ° ì—°ì²œì ê³ ë¬¸ë¦¬</addr1>
    <addr2></addr2>
    <areacode>31</areacode>
    <cat1>A01</cat1>
    <cat2>A0101</cat2>
    <cat3>A01010800</cat3>
    <contentid>2843976</contentid>
    <contenttypeid>12</contenttypeid>
    <createdtime>20220825100444</createdtime>
    <firstimage>http://tong.visitkorea.or.kr/cms/resource/38/2843938_image2_1.jpg</firstimage>
    <firstimage2>http://tong.visitkorea.or.kr/cms/resource/38/2843938_image3_1.jpg</firstimage2>
    <cpyrhtDivCd>Type3</cpyrhtDivCd>
    <mapx>127.1413164638</mapx>
    <mapy>38.0765560961</mapy>
    <mlevel>6</mlevel>
    <modifiedtime>20250702091117</modifiedtime>
    <sigungucode>21</sigungucode>
    <tel></tel>
    <title>ì¬ì¸í­í¬ ì¶œë ë‹¤ë¦¬</title>
    <zipcode>11018</zipcode>
    <lDongRegnCd>41</lDongRegnCd>
    <lDongSignguCd>800</lDongSignguCd>
    <lclsSystm1>NA</lclsSystm1>
    <lclsSystm2>NA01</lclsSystm2>
    <lclsSystm3>NA010300</lclsSystm3>
  </item>
</items>  <numOfRows>12</numOfRows>
  <pageNo>1</pageNo>
  <totalCount>15</totalCount>
</body></response>`;

/* ------------------ ì „ì—­ ìƒíƒœ ------------------ */
let places = [];            // {id,name,lat,lon,addr,firstimage,raw}
let markers = {};           // id -> marker
let routePolyline = null;
let map;

/* ------------------ ì§€ë„ ì´ˆê¸°í™” ------------------ */
function initMap(){
  map = L.map('map').setView([38.0,127.06], 11);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Â© OpenStreetMap contributors'}).addTo(map);
}
initMap();

/* ------------------ XML íŒŒì‹± ------------------ */
function parseTourXml(xmlText){
  const parser = new DOMParser();
  const doc = parser.parseFromString(xmlText, 'application/xml');
  const items = Array.from(doc.getElementsByTagName('item'));
  const out = items.map(it => {
    const get = tag => {
      const e = it.getElementsByTagName(tag)[0];
      return e ? e.textContent.trim() : '';
    };
    const mapx = parseFloat(get('mapx') || NaN);
    const mapy = parseFloat(get('mapy') || NaN);
    return {
      id: get('contentid') || (Math.random()+''),
      name: get('title') || 'ë¬´ì œ',
      addr: get('addr1') || '',
      lat: isFinite(mapy) ? mapy : null,
      lon: isFinite(mapx) ? mapx : null,
      firstimage: get('firstimage') || '',
      raw: it
    };
  }).filter(p => p.lat && p.lon);
  return out;
}

/* ------------------ UI ë Œë”ë§ ------------------ */
function clearMarkers(){
  for (const k in markers) {
    try { map.removeLayer(markers[k]); } catch(e){}
  }
  markers = {};
}

function renderMarkers(){
  clearMarkers();
  places.forEach(p => {
    const m = L.marker([p.lat,p.lon]).addTo(map);
    const popupHtml = `<strong>${escapeHtml(p.name)}</strong><br>${escapeHtml(p.addr)}<br><a href="#" onclick="showDetail('${p.id}');return false;">ìì„¸íˆ ë³´ê¸°</a>`;
    m.bindPopup(popupHtml);
    m.on('click', ()=> showDetail(p.id));
    markers[p.id] = m;
  });
  if (places.length) {
    const bounds = L.latLngBounds(places.map(p=>[p.lat,p.lon]));
    map.fitBounds(bounds.pad(0.2));
  }
}

function renderList(){
  const list = document.getElementById('list');
  list.innerHTML = '';
  for (const p of places){
    const el = document.createElement('div');
    el.className = 'card';
    const img = p.firstimage ? p.firstimage : 'https://via.placeholder.com/480x320?text=No+Image';
    el.innerHTML = `<img src="${img}" alt="${escapeHtml(p.name)}">
      <div class="meta"><strong>${escapeHtml(p.name)}</strong><small>${escapeHtml(p.addr)}</small></div>`;
    el.onclick = ()=> { showDetail(p.id); focusOn(p.id); };
    list.appendChild(el);
  }
  populateStartSelect();
}

/* ------------------ ìƒì„¸ ë³´ê¸° ------------------ */
function showDetail(id){
  const p = places.find(x=>x.id==id);
  if (!p) return;
  const d = document.getElementById('detail');
  const img = p.firstimage ? p.firstimage : 'https://via.placeholder.com/1200x600?text=No+Image';
  d.style.display = 'block';
  d.innerHTML = `<img src="${img}" alt="${escapeHtml(p.name)}">
    <h3 style="color:var(--primary);margin-bottom:6px">${escapeHtml(p.name)}</h3>
    <p style="color:#555">${escapeHtml(p.addr)}</p>
    <p style="margin-top:8px"><strong>ìœ„ì¹˜:</strong> ${p.lat.toFixed(6)}, ${p.lon.toFixed(6)}</p>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn" onclick="focusOn('${p.id}')">ì§€ë„ì—ì„œ ë³´ê¸°</button>
      <a class="btn ghost" href="#" onclick="openDirections(${p.lat},${p.lon});return false;">ê¸¸ì°¾ê¸°</a>
    </div>`;
}

/* ------------------ í¬ì»¤ìŠ¤ & ê¸¸ì°¾ê¸° ------------------ */
function focusOn(id){
  const m = markers[id];
  if (m) { map.setView(m.getLatLng(), 13); m.openPopup(); }
}
function openDirections(lat, lon){
  const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}`;
  window.open(url,'_blank');
}

/* ------------------ ë°ì´í„° ë¡œë“œ (API or sample) ------------------ */
async function loadFromService(){
  if (!SERVICE_URL) {
    alert('SERVICE_URL ë³€ìˆ˜ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ì½”ë“œë¥¼ ì—´ì–´ SERVICE_URLì— ìš”ì²­ URL(ì„œë¹„ìŠ¤í‚¤ í¬í•¨)ì„ ë„£ìœ¼ì„¸ìš”.\n(CORSë¡œ ì¸í•´ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.)');
    return;
  }
  try {
    const res = await fetch(proxyIfNeeded(SERVICE_URL));
    if (!res.ok) throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨: '+res.status);
    const txt = await res.text();
    const parsed = parseTourXml(txt);
    places = parsed;
    renderMarkers();
    renderList();
    alert('APIì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤: ' + places.length + 'ê±´');
  } catch (e) {
    console.error(e);
    alert('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.\nëŒ€ì‹  ë‚´ì¥ ìƒ˜í”Œì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
  }
}

// ê¸°ë³¸: ë‚´ì¥ XML ìƒ˜í”Œ ì‚¬ìš©
function loadFromSample(){
  places = parseTourXml(xmlSample);
  renderMarkers();
  renderList();
}

/* ------------------ "ì¶”ì²œ ë£¨íŠ¸" (Nearest Neighbor) ------------------ */
function haversine(a,b){
  // a,b: {lat,lon}. returns km
  const toRad = v => v * Math.PI/180;
  const R = 6371; // km
  const dLat = toRad(b.lat - a.lat);
  const dLon = toRad(b.lon - a.lon);
  const lat1 = toRad(a.lat), lat2 = toRad(b.lat);
  const sinDlat = Math.sin(dLat/2), sinDlon = Math.sin(dLon/2);
  const A = sinDlat*sinDlat + sinDlon*sinDlon * Math.cos(lat1)*Math.cos(lat2);
  const C = 2 * Math.atan2(Math.sqrt(A), Math.sqrt(1-A));
  return R * C;
}

function recommendRoute(){
  if (!places.length) return alert('ë¨¼ì € ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.');
  // ì‹œì‘ì§€ ì„ íƒ
  const startId = document.getElementById('start-select').value || places[0].id;
  const start = places.find(p=>p.id==startId);
  if (!start) return alert('ì‹œì‘ì ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

  const unvisited = places.filter(p => p.id !== start.id).slice();
  const route = [start];
  while (unvisited.length){
    const last = route[route.length-1];
    unvisited.sort((a,b) => {
      const da = haversine({lat:last.lat,lon:last.lon},{lat:a.lat,lon:a.lon});
      const db = haversine({lat:last.lat,lon:last.lon},{lat:b.lat,lon:b.lon});
      return da - db;
    });
    route.push(unvisited.shift());
  }

  // ì§€ìš°ê¸° ë° ì§€ë„ì— ê²½ë¡œ ê·¸ë¦¬ê¸°
  if (routePolyline) { map.removeLayer(routePolyline); routePolyline = null; }
  const latlngs = route.map(r => [r.lat, r.lon]);
  routePolyline = L.polyline(latlngs, {color: '#0B63B8', weight:5, opacity:0.85}).addTo(map);
  map.fitBounds(routePolyline.getBounds().pad(0.2));

  // ê²°ê³¼ í‘œì‹œ
  const ol = document.getElementById('route-list');
  const rbox = document.getElementById('route-result');
  ol.innerHTML = '';
  let total = 0;
  for (let i=0;i<route.length;i++){
    const li = document.createElement('li');
    li.textContent = `${i+1}. ${route[i].name} â€” ${route[i].addr || ''}`;
    li.onclick = ()=> { showDetail(route[i].id); focusOn(route[i].id); };
    ol.appendChild(li);
    if (i>0) total += haversine(route[i-1], route[i]);
  }
  document.getElementById('total-distance').textContent = (total.toFixed(2)) + ' km';
  rbox.style.display = 'block';
}

/* ------------------ í—¬í¼/ìœ í‹¸ ------------------ */
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]); }

function populateStartSelect(){
  const sel = document.getElementById('start-select');
  sel.innerHTML = '';
  places.forEach(p => {
    const opt = document.createElement('option');
    opt.value = p.id; opt.text = p.name;
    sel.appendChild(opt);
  });
}

/* ------------------ ê°„ë‹¨í•œ proxy ì‹œë„ (CORS ìš°íšŒìš©, ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹œ ì‚¬ìš© ë¶ˆê°€í•  ìˆ˜ ìˆìŒ)  ------------------ */
function proxyIfNeeded(url){
  // ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ìš”ì²­ ì‹œ CORS ì—ëŸ¬ê°€ ë‚˜ë©´ ì„œë²„ í”„ë¡ì‹œ í•„ìš”.
  // ì—¬ê¸°ì„  ì‚¬ìš©ìê°€ ì§ì ‘ í”„ë¡ì‹œë¥¼ ì„¸íŒ…í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì›ë³¸ ë°˜í™˜.
  return url;
}

/* ------------------ ì´ë²¤íŠ¸ ë°”ì¸ë”© ------------------ */
document.getElementById('btn-use-sample').addEventListener('click', ()=> { loadFromSample(); });
document.getElementById('btn-load-api').addEventListener('click', ()=> { loadFromService(); });
document.getElementById('btn-search').addEventListener('click', ()=> {
  const q = document.getElementById('search-input').value.trim().toLowerCase();
  if (!q) return alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
  const found = places.find(p => p.name.toLowerCase().includes(q) || (p.addr && p.addr.toLowerCase().includes(q)));
  if (found) { showDetail(found.id); focusOn(found.id); } else alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
});
document.getElementById('btn-recommend').addEventListener('click', ()=> { recommendRoute(); });
document.getElementById('btn-clear-route').addEventListener('click', ()=> {
  if (routePolyline) { map.removeLayer(routePolyline); routePolyline = null; }
  document.getElementById('route-result').style.display = 'none';
});

/* ------------------ ì´ˆê¸°: ìƒ˜í”Œ ë¡œë“œ ------------------ */
loadFromSample();

</script>
</body>
</html>
